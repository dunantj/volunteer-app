{% extends "base.html" %}

{% block content %}
<h2>Match Volunteering</h2>

<!-- Filter by Home Team or only my matches-->
<form method="get" class="mb-3" style="display:flex; gap:20px; align-items:center; margin-bottom:20px;">
    <div>
        <label for="team">Filter by Home Team:</label>
        <select name="team" id="team" onchange="this.form.submit()" class="btn btn-dark" style="padding:5px; border-radius:4px;">
            <option value="">All Teams</option>
            {% for t in teams %}
                <option value="{{ t }}" {% if t == selected_team %}selected{% endif %}>{{ t }}</option>
            {% endfor %}
        </select>
    </div>
    <div>
        <label for="my_matches" style="margin-left:10px;">
            <input type="checkbox" name="my_matches" id="my_matches" {% if only_my_matches %}checked{% endif %} onchange="this.form.submit()" />
            Matches where I volunteer
        </label>
    </div>
</form>

<!-- Match list -->
{% for item in match_data %}
<div class="match-card" style="padding:15px; border:1px solid #ccc; border-radius:8px; margin-bottom:15px; background:#fafafa;">
    <strong>{{ item.match.date }} {{ item.match.start_time }}:</strong>
    {{ item.match.home_team }} vs {{ item.match.guest_team }} ({{ item.match.location }})
    <br>
    <strong>Volunteers ({{ item.match.volunteer_count }}/3):</strong>
    <div style="display:flex; gap:10px; margin-top:5px; flex-wrap: wrap;">
        {% for slot in item.match.slots.all %}
        <div style="padding:5px 10px; border:1px solid #ccc; border-radius:5px; min-width:80px; text-align:center; background:#f7f7f7;">
            {% if slot.volunteer == user %}
                ✅ {{ slot.volunteer.username }} (you)
            {% elif slot.volunteer %}
                ✅ {{ slot.volunteer.username }}
            {% else %}
                <span>Open slot</span>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    {% if item.can_volunteer and item.open_slot and not item.user_signed_up %}
    <a class="btn btn-blue" href="{% url 'signup_slot' item.match.id item.open_slot.id %}">Volunteer for this match</a>
    {% elif item.user_signed_up %}
    <span class="btn btn-green">You're signed up!</span>
        {% for slot in item.match.slots.all %}
            {% if slot.volunteer == user %}
                <a class="btn btn-dark" href="{% url 'offer_create' %}?slot={{ slot.id }}&type=trade">Request Trade</a>
            {% endif %}
        {% endfor %}
    {% endif %}
</div>
{% endfor %}

{% if not match_data %}
<p>No matches available for volunteering at the moment.</p>
{% endif %}

{% endblock %}
